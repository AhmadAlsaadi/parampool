<!--
Automatically generated HTML file from DocOnce source
(https://github.com/hplgit/doconce/)
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/hplgit/doconce/" />
<meta name="description" content="Parampool Tutorial">
<meta name="keywords" content="submenu,data item">

<title>Parampool Tutorial</title>

<!-- Bootstrap style: bootstrap_bluegray -->
<link href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.rawgit.com/hplgit/doconce/master/bundled/html_styles/style_bootstrap/css/bootstrap_bluegray.css" rel="stylesheet">
<!-- not necessary
<link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
-->

<style type="text/css">
/* Let inline verbatim have the same color as the surroundings */
code { color: inherit; background-color: transparent; }
</style>


</head>

<!-- tocinfo
{'highest level': 1,
 'sections': [(' 2DO ', 3, None, '___sec0'),
              (' Simulation program ', 1, None, '___sec1'),
              (' User interfaces for Python functions ',
               1,
               'pp:GUI4functions',
               'pp:GUI4functions'),
              (' Real numbers as input and output ',
               2,
               'pp:real:inout',
               'pp:real:inout'),
              (' Flask interface ', 3, None, '___sec4'),
              (' Django interface ', 3, None, '___sec5'),
              (' A plot as output ', 2, 'pp:plot:output', 'pp:plot:output'),
              (' Flask application ', 3, None, '___sec7'),
              (' Django application ', 3, None, '___sec8'),
              (' Comparing graphs in the same plot ', 3, None, '___sec9'),
              (' More input parameters and results ',
               2,
               'pp:flask4',
               'pp:flask4'),
              (' Django interface ', 3, None, '___sec11'),
              (' Other types of function arguments ', 2, None, '___sec12'),
              (' Working with a menu of input parameters ',
               1,
               'pp:flask_menu1',
               'pp:flask_menu1'),
              (' Specify a menu as a list ',
               2,
               'pp:flask_menu1:list',
               'pp:flask_menu1:list'),
              (' Attributes in data items ',
               2,
               'pp:flask_menu1:dataitem',
               'pp:flask_menu1:dataitem'),
              (' The compute function ',
               2,
               'pp:flask_menu1:compute',
               'pp:flask_menu1:compute'),
              (' A command-line and file interface ',
               2,
               'pp:flask_menu1:cml_file',
               'pp:flask_menu1:cml_file'),
              (' Generating a web-based user interface ',
               2,
               'pp:flask_menu1:GUI',
               'pp:flask_menu1:GUI'),
              (' Operating the user interface ',
               2,
               'pp:flask_menu1:GUI_op',
               'pp:flask_menu1:GUI_op'),
              (' Detection of wrong input ',
               2,
               'pp:flask_menu1:GUI_error',
               'pp:flask_menu1:GUI_error'),
              (' Loading parameters from file and the command line ',
               2,
               'pp:flask_menu1:GUI_cml_file',
               'pp:flask_menu1:GUI_cml_file'),
              (' Specifying a menu using an API ', 2, None, '___sec22'),
              (' Specifying a menu using an alternative API ',
               2,
               None,
               '___sec23'),
              (' File with documentation of the application ',
               3,
               None,
               '___sec24'),
              (' LaTeX symbol as parameter name ', 3, None, '___sec25'),
              (' Multiple input values for parameters ', 3, None, '___sec26'),
              (' 2DO ', 2, None, '___sec27'),
              (' Reading default values from command line or file ',
               2,
               None,
               '___sec28'),
              (' Menu with other data structures ', 2, None, '___sec29'),
              (' Advanced topics ', 1, None, '___sec30'),
              (' Login and archival of results ', 2, None, '___sec31'),
              (' Animations ', 2, None, '___sec32'),
              (' Python expressions as input ', 2, None, '___sec33'),
              (' Exercises ', 1, None, '___sec34'),
              (' Exercise 1: Make a web app for integration ',
               2,
               None,
               '___sec35'),
              (' Exercise: Make a web app for studying vibrations ',
               1,
               None,
               '___sec36'),
              (' Problem 2: Make a coin flipper ', 2, None, '___sec37'),
              (' Deployment ', 1, None, '___sec38'),
              (' Wakari ', 2, None, '___sec39'),
              (' Uni Oslo ', 2, None, '___sec40'),
              (' Appendix: Installation ', 1, None, '___sec41')]}
end of tocinfo -->

<body>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "none"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



    
<!-- Bootstrap navigation bar -->
<div class="navbar navbar-default navbar-fixed-top">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="pp.html">Parampool Tutorial</a>
  </div>
  <div class="navbar-collapse collapse navbar-responsive-collapse">
    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contents <b class="caret"></b></a>
        <ul class="dropdown-menu">
     <!-- navigation toc: --> <li><a href="._pp002.html#___sec1" style="font-size: 80%;">Simulation program</a></li>
     <!-- navigation toc: --> <li><a href="._pp003.html#pp:GUI4functions" style="font-size: 80%;">User interfaces for Python functions</a></li>
     <!-- navigation toc: --> <li><a href="._pp004.html#pp:flask_menu1" style="font-size: 80%;">Working with a menu of input parameters</a></li>
     <!-- navigation toc: --> <li><a href="._pp005.html#___sec30" style="font-size: 80%;">Advanced topics</a></li>
     <!-- navigation toc: --> <li><a href="#___sec34" style="font-size: 80%;">Exercises</a></li>
     <!-- navigation toc: --> <li><a href="#___sec36" style="font-size: 80%;">Exercise: Make a web app for studying vibrations</a></li>
     <!-- navigation toc: --> <li><a href="#___sec38" style="font-size: 80%;">Deployment</a></li>
     <!-- navigation toc: --> <li><a href="#___sec41" style="font-size: 80%;">Appendix: Installation</a></li>

        </ul>
      </li>
    </ul>
  </div>
</div>
</div> <!-- end of navigation bar -->

<div class="container">

<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p> <!-- add vertical space -->

<a name="part0006"></a>
<!-- !split -->

<h1 id="___sec34">Exercises </h1>

<p>
<!-- --- begin exercise --- -->

<h2 id="___sec35">Exercise 1: Make a web app for integration </h2>

<p>
The purpose of this exercise is to use Parampool to generate a
simple web application for integrating functions: \( \int_a^bf(x)dx \).
Provide a symbolic expression for \( f(x) \) and the limits \( a \) and \( b \)
as input. The application returns the integral of \( \int_a^bf(x)dx \)
computed by some numerical integration rule (e.g., the Trapezoidal
rule). Also try to integrate \( f(x) \) symbolically with the aid
<code>sympy</code> and write out the anti-derivative of \( f(x) \) if the
integration is successful.

<p>
<!-- --- begin hint in exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_1_1" style="font-size: 80%;"></a>
<b>Hint.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_1_1">

<p>
The relevant <code>sympy</code> code needs to turn the string expression
for \( f(x) \) into a valid symbolic expression via <code>eval</code>.
This process requires import of the mathematical functions in <code>sympy</code>.
Thereafter, the <code>integrate</code> functionality in <code>sympy</code> can be used
to compute the integral.

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">symbolic_integration</span>(f_str):
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;</span>
<span style="color: #BA2121; font-style: italic">    Return the LaTeX code of the anti-derivative of f(x),</span>
<span style="color: #BA2121; font-style: italic">    where f_str holdes the formula for f(x) in a string.</span>
<span style="color: #BA2121; font-style: italic">    Return None if sympy cannot compute the anti-derivative.</span>
<span style="color: #BA2121; font-style: italic">    &quot;&quot;&quot;</span>
    <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">sympy</span> <span style="color: #008000; font-weight: bold">import</span> Symbol, integrate, \ 
      sin, cos, tan, log, asin, acos, atan, \ 
      sinh, cosh, tanh, asinh, acosh, atanh, erf, erfc,
    x <span style="color: #666666">=</span> Symbol(<span style="color: #BA2121">&#39;x&#39;</span>)
    f <span style="color: #666666">=</span> <span style="color: #008000">eval</span>(f_str)
    I <span style="color: #666666">=</span> integrate(f, x)
    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">isinstance</span>(I, Integral):
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">None</span>
    <span style="color: #008000; font-weight: bold">else</span>:
        <span style="color: #008000; font-weight: bold">return</span> latex(I)
</pre></div>
<p>
</div></p>
</div>
</p>

<p>
<!-- --- end hint in exercise --- -->

<p>
<!-- --- end exercise --- -->

<h1 id="___sec36">Exercise: Make a web app for studying vibrations </h1>

<p>
Download <code>bumpy</code>. Set up prms.

$$
\begin{equation}
mu'' + f(u') + s(u) = F(t),
\tag{2}
\end{equation}
$$

<p>
Make an interface to
it such that

<ul>
   <li> s=k*u, have k as parameter, linear damping, F=0, V=0</li>
   <li> F=A*sin(w*t), A and w are parameters</li>
   <li> damping with two values and radio buttons, b</li>
   <li> s is a text expression</li>
   <li> F is a filename (0 is default)</li>
   <li> there is a submenu for F with different models: filename,
     A*sin(w*t) (submenu), white noise with intensity, formula of t</li>
   <li> another submenu for s models</li>
</ul>

On the main menu: damping can have radio buttons for linear b*u and
quadratic b*u**2, F has list of different type of forces

<p>
<!-- --- begin exercise --- -->

<h2 id="___sec37">Problem 2: Make a coin flipper </h2>

<p>
Make a web application where we can set the number of coins to be
flipped. Clicking on the <em>Submit</em> button (whose name should rather
be <em>flip</em>) shows images of coins with heads and tails according to
a random flip of each coin.

<p>
<!-- --- begin hint in exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_2_1" style="font-size: 80%;"></a>
<b>Hint.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_2_1">

<p>
See <a href="random.org/coins" target="_self"><tt>random.org/coins</tt></a> for inspiration and images of coins.

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end hint in exercise --- -->
Filename: <code>coin_flipper</code>.

<p>
<!-- --- end exercise --- -->

<h1 id="___sec38">Deployment </h1>

<p>
The most obvious servers to deploy web applications on, like Google App Engine,
only support very light weight Python. For heavier scientific applications
we may need more tools; SSH access, a Fortran compiler, etc. Therefore we
introduce two servers we recommend for the scientific computing usage.

<h2 id="___sec39">Wakari </h2>

<p>
<a href="https://www.wakari.io" target="_self">Wakari</a> is originally meant to be a Python
data analysis environment for internet-accessible services and sharing
of computing environments.  It does not allow users to deploy
webservers that can be accessed by others. However, accessing a Flask
server process running in Wakari is possible using SSH tunneling:

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">wakari-terminal&gt; python controller.py
laptop-terminal&gt; ssh -p [port] -f -N -L 5000:localhost:5000 \ 
                 [username]@[wakari-hostname].wakari.io
</pre></div>
<p>
<div class="alert alert-block alert-success alert-text-normal"><b>Port - username - hostname.</b>

<p>
Information about which port to forward, as well as username and
wakari-hostname, is available under <code>SSH Access</code> at the user submeu in
Wakari.

<p>
<center><p><img src="fig-pp/wakari1.png" align="bottom" width=350></p></center>

<p>
It is also necessary to add your
public SSH key to Wakari
<a href="https://www.wakari.io/settings/sshkeys" target="_self">Settings</a>.

<p>
</div>


<p>
Now the application is available as usual at <code>http://127.0.0.1:5000/</code>
on your laptop.

<p>
Even though only Flask and not Django is pre-installed in Wakari, it
is relatively straight-forward to download Django
<a href="https://www.djangoproject.com/download/" target="_self">source</a> and install it
locally to your user. Also, if Gnuplot is to be installed and compiled
with PNG support, the library <code>Pnglib</code> needs to be installed before
Gnuplot is compiled.

<p>
<!-- The script <code>install_on_wakari.sh</code> in the top -->
<!-- directory of cbc-websolver accomplishes this. -->

<h2 id="___sec40">Uni Oslo </h2>

<p>
The biggest downside with the Uni Oslo server is that you need to be a
student or employee to access it. Nevertheless, the procedure
described below for running web applications through a CGI script can
be applied to any server.

<p>
If only little traffic has to be handled, it is possible to run Flask
and Django through a CGI script. The script imports and starts the
application's wsgi handler and works as a gateway between the Internet
and the Flask or Django server.

<p>
The simplest example of a CGI script running Flask follows:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #408080; font-style: italic">#!/usr/bin/python</span>
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">wsgiref.handlers</span> <span style="color: #008000; font-weight: bold">import</span> CGIHandler
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">controller</span> <span style="color: #008000; font-weight: bold">import</span> app

CGIHandler()<span style="color: #666666">.</span>run(app)
</pre></div>
<p>
This code assumes that the Python executive in <code>/usr/bin/</code> is available and
up-to-date, and that all required Python modules are on the
<code>PYTHONPATH</code> environment and are available to be run by others. As the
Python version on the Uni Oslo server, version 2.5, is no longer
supported by the Python web frameworks, we need to install a newer
version locally and use the absolute path to its executive in the
header of the CGI script.

<p>
With a new Python installation we also need to (re)install all required modules
and add them to <code>sys.path</code>. The script <code>install_on_uio.sh</code> in the top directory
of cbc-websolver installs all required packages locally. Then we can
add the location of these modules to <code>sys.path</code> in the CGI script:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">sys</span>
sys<span style="color: #666666">.</span>path <span style="color: #666666">+=</span> [<span style="color: #BA2121">&#39;/path/to/local/installation/lib/python2.7/site-packages/&#39;</span>]

CGIHandler()<span style="color: #666666">.</span>run(app)
</pre></div>
<p>
One also needs to assure that the location of controller.py is in sys.path,
or the import of app will fail.

<p>
The only difference between the CGI script for Flask and Django is that for
Django one needs to add the directory containing the <code>settings.py</code> file to
<code>sys.path</code> and set <code>os.environ['DJANGO_SETTINGS_MODULE']</code> to settings. Also,
the import of the app is a bit different than before:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">sys<span style="color: #666666">.</span>path <span style="color: #666666">+=</span> [<span style="color: #BA2121">&#39;path/to/myproject&#39;</span>] <span style="color: #408080; font-style: italic"># The folder containing settings.py</span>
os<span style="color: #666666">.</span>environ[<span style="color: #BA2121">&#39;DJANGO_SETTINGS_MODULE&#39;</span>] <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;myproject.settings&#39;</span>

app <span style="color: #666666">=</span> django<span style="color: #666666">.</span>core<span style="color: #666666">.</span>handlers<span style="color: #666666">.</span>wsgi<span style="color: #666666">.</span>WSGIHandler()
CGIHandler()<span style="color: #666666">.</span>run(app)
</pre></div>
<p>
<div class="alert alert-block alert-success alert-text-normal"><b>Make CGI script accessible for others.</b>
Remember that all scripts and modules to be accessed from the web need to
have permissions for everyone to read and execute. This can be done by, e.g.,

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%">Terminal&gt; chmod 755 run_django.cgi
</pre></div>
<p>
</div>


<p>
<!-- begin bibliography -->

<ol>
 <li> <div id="Langtangen:web4sciapps"></div> <b>H. P. Langtangen and A. E. Johansen</b>. 
    Using Web Frameworks for Scientific Web Applications,
    <em>Simula Research Laboratory and University of Oslo</em>,
    <a href="http://hplgit.github.com/web4sciapps/doc/web/" target="_self"><tt>http://hplgit.github.com/web4sciapps/doc/web/</tt></a>,
    2013.</li>
</ol>

<!-- end bibliography -->

<h1 id="___sec41">Appendix: Installation </h1>

<p>
We need

<ul>
 <li> Flask: <code>sudo pip install Flask</code></li>
 <li> Django (optional): <code>sudo pip install django</code></li>
 <li> progressbar: <code>sudo pip install progressbar</code></li>
 <li> Flask-WTF: <code>pip install Flask-WTF</code></li>
 <li> Flask-SQLAlchemy: <code>sudo pip install Flask-SQLAlchemy</code></li>
 <li> Flask-Login: <code>sudo pip install Flask-Login</code></li>
 <li> Flask-Mail: <code>sudo pip install Flask-Mail</code></li>
</ul>


<p>
<!-- navigation buttons at the bottom of the page -->
<ul class="pagination">
<li><a href="._pp005.html">&laquo;</a></li>
  <li><a href="._pp000.html">1</a></li>
  <li><a href="._pp001.html">2</a></li>
  <li><a href="._pp002.html">3</a></li>
  <li><a href="._pp003.html">4</a></li>
  <li><a href="._pp004.html">5</a></li>
  <li><a href="._pp005.html">6</a></li>
  <li class="active"><a href="._pp006.html">7</a></li>
</ul>
<!-- ------------------- end of main content --------------- -->

</div>  <!-- end container -->
<!-- include javascript, jQuery *first* -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

<!-- Bootstrap footer
<footer>
<a href="http://..."><img width="250" align=right src="http://..."></a>
</footer>
-->


</body>
</html>
    

